Лабораторная работа №3 — Предотвращение XSS‑атак

Коротко о приложении. Я сделал мини‑гостевую книгу: форма принимает имя пользователя, e‑mail и текст сообщения, 
а ниже выводится список всех записей из базы. База данных называется `guest`, 
в ней есть таблица `guest` с полями: `id`, `user`, `text_message`, `e_mail`, `data_time_message`. 
При добавлении записи фиксируется время публикации.

Сначала я показал уязвимость XSS. На первом шаге вывод сообщений был настроен без экранирования, 
поэтому введённый HTML/JS попадал на страницу как есть. Я проверил несколько сценариев:
- Редирект: в текст сообщения вставил `<script>location.href='https://example.com'</script>` — при просмотре списка записей пользователь перенаправлялся на другой сайт.
- Подмена содержимого страницы: добавил `<script>document.body.innerHTML='<img src="/img/x.png" style="width:100%">'</script>` — всё, 
что было между `<body>…</body>`, заменялось изображением.
Эти примеры демонстрируют, что без проверки/экранирования полей гостевой книги страница уязвима к XSS.

Далее я устранил уязвимость и добавил защиту. Основные меры:
- Экранирование на выводе: для всех пользовательских полей (`user`, `e_mail`, `text_message`) 
применяется HTML‑экранирование перед вставкой в страницу, чтобы теги и скрипты отображались как текст, а не исполнялись.
- Санитизация/валидация на сервере: обрезаю лишние пробелы, ограничиваю длину полей, удаляю опасные теги/атрибуты из `text_message` 
по белому списку (если предусмотрены форматирования — иначе просто запрещаю HTML полностью).
- Валидация на клиенте: HTML5‑атрибуты (`required`, паттерн для e‑mail) и проверка длины/символов — удобно для пользователя, 
но основная защита остаётся на сервере.
- Заголовки безопасности: добавил Content‑Security‑Policy 
(например, `default-src 'self'; script-src 'self' 'nonce-...'; object-src 'none'`) — это ограничивает выполнение произвольных скриптов, 
даже если где-то пропущено экранирование.

После исправлений я повторно попробовал те же XSS‑вставки. Редирект не срабатывает: скрипт выводится как текст. 
Аналогично, попытка подменить содержимое страницы отображается как обычная строка, а не выполняется. 
Список сообщений корректно показывает введённый текст, админстраница и интерфейс не ломаются.

Как выполнены требования задания:
1) Демонстрация XSS‑атак через контролы формы показана: редирект и подмена содержимого страницы подтверждены на уязвимой версии — выполнено.
2) Добавлены проверки и защита от XSS: экранирование вывода, серверная санитизация/валидация, клиентская валидация и CSP — выполнено.

Что могу показать на защите: коротко показать, как сообщение со скриптом ломало страницу «до», 
и как то же сообщение безопасно отображается «после»; показать фрагмент кода экранирования/санитизации и заголовок CSP в ответах. 
При необходимости — логи запросов с временем публикации, подтверждающие, что данные сохраняются и корректно выводятся.

Итог: гостевая книга изначально была уязвима к XSS, уязвимость продемонстрирована и закрыта. Теперь пользовательский ввод не исполняется как код, 
а отображается безопасно; защита реализована на сервере и дополнена настройками браузерной политики и валидацией на клиенте.
