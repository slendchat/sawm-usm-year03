Лабораторная работа №2 — Методы предотвращения SQL‑инъекций

Коротко о том, что было сделано. Я реализовал простое мини‑приложение с двумя страницами: 
страница входа с формой (логин и пароль) и закрытая админ‑страница, доступ к которой открыт только после успешной аутентификации. 
Данные пользователей храню в базе данных в таблице `user` с полями `id`, `login`, `password_hash`. 
Таблицу заполнил как минимум семью пользователями.

Сначала я намеренно показал уязвимость. На первом шаге вход был реализован небезопасно: 
в запросе к базе данные из формы подставлялись напрямую, без параметров. 
Это позволило продемонстрировать SQL‑инъекции. Я пробовал классические варианты — например, ввести в поле логина `' OR '1'='1`, либо `admin' --`. 
В результате без знания пароля удавалось попасть в админ‑зону. Этого достаточно, чтобы убедиться: конкатенация строк в SQL — опасная практика.

После демонстрации я устранил уязвимость и выполнил требования по защите. 
Во‑первых, заменил конкатенацию на подготовленные выражения (prepared statements) с параметрами в обработчике логина. 
Во‑вторых, добавил валидацию на стороне сервера: ограничил допустимые символы в логине и длину пароля, обрезаю пробелы и отвергаю подозрительные вводы. 
На стороне клиента оставил HTML5‑валидацию и простые проверки формата — это удобно для пользователя, но основная защита именно на сервере. 
Пароли храню не в открытом виде, а в виде хеша (подходит bcrypt/argon2), при входе сравниваю введённый пароль с хешем через стандартную функцию проверки. 
Пользователю базы выдал минимально необходимые права: только чтение для проверки логина, чтобы даже при ошибке приложения нельзя было выполнять опасные операции. 
Также убрал вывод подробных ошибок SQL наружу: пользователю показывается нейтральное сообщение «Неверные данные», а подробности пишутся в лог.

Дальше я повторил атаки. Те же инъекции, которые раньше давали доступ, теперь не срабатывают: 
параметры не интерпретируются как часть SQL, приложение корректно отклоняет попытки. 
Админ‑страница остаётся недоступной без активной сессии. При верных данных вход проходит штатно.

Как выполнены требования задания:
1) В таблицу `user` добавлено 7 новых записей — выполнено.
2) SQL‑инъекции опробованы на изначально уязвимой версии, вход без пароля показал уязвимость — выполнено.
3) Сделаны client‑side и server‑side меры: валидация полей на клиенте; на сервере — параметризованные запросы, строгая проверка ввода, 
    хеширование паролей, нейтральные сообщения об ошибках — выполнено.
4) Проведена проверка безопасности мини‑приложения повторными атаками, все инъекции блокируются, доступ к админке защищён — выполнено.

Что могу показать на защите: коротко показать участок кода «до и после» в обработчике логина, 
продемонстрировать попытки инъекций и их результат, а также показать, что пароли в базе хешированы и учётная запись без сессии не пускает в админ‑зону.

Итог: уязвимость продемонстрирована и закрыта. Все запросы, зависящие от пользовательского ввода, 
переведены на подготовленные выражения, ввод валидируется, пароли хешируются, раскрытие деталей ошибок исключено. 
Повторные проверки подтверждают, что SQL‑инъекции не проходят, а требования лабораторной работы выполнены.
